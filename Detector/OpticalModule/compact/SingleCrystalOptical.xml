<lccdd>
  <info name="SingleCrystalOptical"
    title="single crystal for optical simulation "
    author="Chengdong Fu"
    url="None"
    status="development"
    version="1.0">
    <comment>Crystal optical simulation, optical parameters should be updated to real or considered</comment>
  </info>

  <define>
    <constant name="world_side" value="1*m"/>
    <constant name="world_x"    value="world_side/2"/>
    <constant name="world_y"    value="world_side/2"/>
    <constant name="world_z"    value="world_side/2"/>
  </define>

  <debug>
    <type name="surface" value="1"/>
  </debug>

  <includes>
    <gdmlFile  ref="${DD4hepINSTALL}/DDDetectors/compact/elements.xml"/>
  </includes>

  <properties>
    <matrix name="RINDEX__Tyvek"    coldim="2" values="2.034*eV 1.52         4.136*eV 1.52"/>
    <matrix name="ABSLENGTH__Tyvek" coldim="2" values="2.034*eV 1.59*mm      4.136*eV 1.59*mm"/>
    <matrix name="RINDEX__Glass"    coldim="2" values="2.034*eV 1.49         4.136*eV 1.49"/>
    <matrix name="ABSLENGTH__Glass" coldim="2" values="2.034*eV 623*cm       4.136*eV 623*cm"/>
    <matrix name="RINDEX__Air"      coldim="2" values="2.034*eV 1.           4.136*eV 1."/>
    <matrix name="RINDEX__BGO"      coldim="2" values="2.034*eV 2.41         4.136*eV 2.10"/>
    <!--fake BGO data as example copied from water data-->
    <matrix name="ABSLENGTH__BGO"   coldim="2" values="
              2.034*eV 3.448*m  
              2.068*eV 4.082*m  
              2.103*eV 6.329*m  
              2.139*eV 9.174*m 
              2.177*eV 12.346*m 
              2.216*eV 13.889*m
              2.256*eV 15.152*m 
              2.298*eV 17.241*m 
              2.341*eV 18.868*m 
              2.386*eV 20.000*m 
              2.433*eV 26.316*m 
              2.481*eV 35.714*m
              2.532*eV 45.455*m 
              2.585*eV 47.619*m 
              2.640*eV 52.632*m 
              2.697*eV 52.632*m 
              2.757*eV 55.556*m 
              2.820*eV 52.632*m
              2.885*eV 52.632*m 
              2.954*eV 47.619*m 
              3.026*eV 45.455*m 
              3.102*eV 41.667*m 
              3.181*eV 37.037*m 
              3.265*eV 33.333*m
              3.353*eV 30.000*m 
              3.446*eV 28.500*m 
              3.545*eV 27.000*m 
              3.649*eV 24.500*m 
              3.760*eV 22.000*m 
              3.877*eV 19.500*m
              4.002*eV 17.500*m 
              4.136*eV 14.500*m
    "/>
    <matrix name="FASTCOMPONENT__BGO" coldim="2" values="  
              2.034*eV 1
              2.068*eV 1
              2.103*eV 1
              2.139*eV 1
              2.177*eV 1
              2.216*eV 1
              2.256*eV 1
              2.298*eV 1
              2.341*eV 1
              2.386*eV 1
              2.433*eV 1
              2.481*eV 1
              2.532*eV 1
              2.585*eV 1
              2.640*eV 1
              2.697*eV 1
              2.757*eV 1
              2.820*eV 1
              2.885*eV 1
              2.954*eV 1
              3.026*eV 1
              3.102*eV 1
              3.181*eV 1
              3.265*eV 1
              3.353*eV 1
              3.446*eV 1
              3.545*eV 1
              3.649*eV 1
              3.760*eV 1
              3.877*eV 1
              4.002*eV 1
              4.136*eV 1
    "/>
    <matrix name="SLOWCOMPONENT__BGO" coldim="2" values="  
              2.034*eV 0.01
              2.068*eV 1
              2.103*eV 2
              2.139*eV 3
              2.177*eV 4
              2.216*eV 5
              2.256*eV 6
              2.298*eV 7
              2.341*eV 8
              2.386*eV 9
              2.433*eV 8
              2.481*eV 7
              2.532*eV 6
              2.585*eV 4
              2.640*eV 3
              2.697*eV 2
              2.757*eV 1
              2.820*eV 0.01
              2.885*eV 1
              2.954*eV 2
              3.026*eV 3
              3.102*eV 4
              3.181*eV 5
              3.265*eV 6
              3.353*eV 7
              3.446*eV 8
              3.545*eV 9
              3.649*eV 8
              3.760*eV 7
              3.877*eV 6
              4.002*eV 5
              4.136*eV 4
    "/>
  </properties>
 
  <materials>
    <material name="Air">
      <D type="density" unit="g/cm3" value="0.0012"/>
      <fraction n="0.754" ref="N"/>
      <fraction n="0.234" ref="O"/>
      <fraction n="0.012" ref="Ar"/>
      <property name="RINDEX"        ref="RINDEX__Air"/>
    </material>
    <material name="Vacuum">  
      <D type="density" unit="g/cm3" value="0.0000000001" />
      <fraction n="0.754" ref="N"/>
      <fraction n="0.234" ref="O"/>
      <fraction n="0.012" ref="Ar"/>
    </material>
    <material name="BGO">
      <D type="density" value="7.13" unit="g/cm3"/>
      <fraction n="0.154126" ref="O"/>
      <fraction n="0.17482"  ref="Ge"/>
      <fraction n="0.671054" ref="Bi"/>
      <property name="RINDEX"              ref="RINDEX__BGO"/>
      <property name="ABSLENGTH"           ref="ABSLENGTH__BGO"/>
      <property name="FASTCOMPONENT"       ref="FASTCOMPONENT__BGO"/>
      <property name="SLOWCOMPONENT"       ref="SLOWCOMPONENT__BGO"/>
      <constant name="SCINTILLATIONYIELD"  value="100.0/MeV"/>
      <constant name="RESOLUTIONSCALE"     value="1.0"/>
      <constant name="FASTTIMECONSTANT"    value="60.0*ns"/>
      <constant name="SLOWTIMECONSTANT"    value="300.0*ns"/>
      <constant name="YIELDRATIO"          value="0.8"/>
    </material>

    <material name="Tyvek">
      <D type="density" value="0.94" unit="g/cm3"/>
      <fraction n="0.143711" ref="H"/>
      <fraction n="0.856289" ref="C"/>
      <property name="RINDEX"              ref="RINDEX__Tyvek"/>
      <property name="ABSLENGTH"           ref="ABSLENGTH__Tyvek"/>
    </material>

    <material name="Mylar">
      <D type="density" value="1.4" unit="g/cm3"/>
      <fraction n="0.041959" ref="H"/>
      <fraction n="0.625016" ref="C"/>
      <fraction n="0.333025" ref="C"/>
    </material>

    <!--one example glass, should move to real glass--> 
    <material name="SiliconOxide">
      <D type="density" value="2.65" unit="g/cm3"/>
      <composite n="1" ref="Si"/>
      <composite n="2" ref="O"/>
    </material>
    <material name="BoronOxide">
      <D type="density" value="2.46" unit="g/cm3"/>
      <composite n="2" ref="B"/>
      <composite n="3" ref="O"/>
    </material>
    <material name="SodiumOxide">
      <D type="density" value="2.65" unit="g/cm3"/>
      <composite n="2" ref="Na"/>
      <composite n="1" ref="O"/>
    </material>
    <material name="AluminumOxide">
      <D type="density" value="3.89" unit="g/cm3"/>
      <composite n="2" ref="Al"/>
      <composite n="3" ref="O"/>
    </material>
    <material name="PyrexGlass">
      <D type="density" value="2.23" unit="g/cm3"/>
      <fraction n="0.806" ref="SiliconOxide"/>
      <fraction n="0.130" ref="BoronOxide"/>
      <fraction n="0.040" ref="SodiumOxide"/>
      <fraction n="0.023" ref="AluminumOxide"/>
      <property name="RINDEX"              ref="RINDEX__Glass"/>
      <property name="ABSLENGTH"           ref="ABSLENGTH__Glass"/>
    </material>
  </materials>

  <display>
    <vis name="ModuleVis"    alpha="0.1"   r="1"   g="1" b="1.0"  showDaughters="true"  visible="false"/>
    <vis name="CrystalVis"    alpha="0.5"   r="0"   g="0.0" b="1.0"  showDaughters="true"  visible="true"/>
    <vis name="WrapVis"  alpha="0.1"   r="1"   g="0.0" b="0.0"  showDaughters="true"  visible="true"/>
    <vis name="GlassVis"  alpha="0.3"   r="1"   g="1.0" b="0.0"  showDaughters="true"  visible="true"/>
    <vis name="CathnodeVis"  alpha="0.8"   r="1"   g="0.0" b="0.0"  showDaughters="true"  visible="true"/>
    <vis name="ShellVis"  alpha="0.9"   r="1"   g="1" b="1"  showDaughters="true"  visible="true"/>
  </display>

  <surfaces>
    <opticalsurface name="/world/SingleCrystalModule#CrystalSurface" finish="polishedtyvekair" model="LUT" type="dielectric_LUT"/>
    <opticalsurface name="/world/SingleCrystalModule#PMSurface" finish="polished" model="glisur" type="dielectric_dielectric" value="1">
      <property name="REFLECTIVITY"            coldim="2" values="2.034*eV  0.01   4.136*eV  0.01"/>
      <property name="EFFICIENCY"              coldim="2" values="2.034*eV  0.0   4.136*eV  0"/>
    </opticalsurface>
    <!--Once ShellSurface and CathodeSurface active, PMSurface will not work, optical photon refract and reflect according RINDEX of two sides of mateials-->  
    <opticalsurface name="/world/SingleCrystalModule#ShellSurface" finish="polished" model="unified" type="dielectric_metal">
      <property name="REFLECTIVITY"            coldim="2" values="2.034*eV  0.9   4.136*eV  0.9"/>
      <property name="EFFICIENCY"              coldim="2" values="2.034*eV  0.    4.136*eV  0."/>
    </opticalsurface>
    <opticalsurface name="/world/SingleCrystalModule#CathodeSurface" finish="polished" model="unified" type="dielectric_metal">
      <property name="REFLECTIVITY"            coldim="2" values="2.034*eV  0.   4.136*eV  0."/>
      <property name="EFFICIENCY"              coldim="2" values="2.034*eV  1    4.136*eV  1"/>
    </opticalsurface>
  </surfaces>

  <detectors>
    <detector name="SingleCrystalModule" type="DD4hep_SingleCrystalOptical" vis="ModuleVis"
	      x="10*cm" y="0" z="0" gap="1*mm" id="1" sensitive="true" readout="CaloHitsCollection">
      <crystal   dx="1*cm" dy="1*cm" length="40*cm" gap="0" material="BGO"  vis="CrystalVis"/>
      <wrap      vis="WrapVis">
	<layer   thickness="0.3*mm" material="Tyvek"/>
	<layer   thickness="0.5*mm" material="Al"/>
	<layer   thickness="0.2*mm" material="Mylar"/>
      </wrap>
      <!-- two types of shape of PM-->
      <!--PM       type="Square" x="0" y="0" depth="1*mm" dx="1.0*cm" dy="1.0*cm" thickness="4*mm" vis="GlassVis" material="PyrexGlass"> 
	<cathode   dx="0.9*cm" dy="0.9*cm" thickness="0.2*mm" vis="CathodeVis" material="Al" active="0"/>
	<shell     thickness="0.5*mm" vis="ShellVis" material="Al" active="0"/>
      </PM-->
      <PM       type="Circular" x="0" y="0" depth="1*mm" dr="0.5*cm" thickness="4*mm" vis="GlassVis" material="PyrexGlass">
        <cathode   dr="0.45*cm" thickness="0.2*mm" vis="CathodeVis" material="Al" active="1"/>
        <shell     thickness="0.5*mm" vis="ShellVis" material="Al" active="1"/>
      </PM>
    </detector>
  </detectors>

  <readouts>
    <readout name="CaloHitsCollection">
      <segmentation type="CartesianGridXY" grid_size_x="1*mm" grid_size_y="1*m"/>
      <id>system:6,module:5,stave:5,layer:6,crystal:8,pmt:2,x:32:-16,y:-16</id>
    </readout>
  </readouts>

</lccdd>
  
